<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 Workshop - Israeli Privacy and Fairness Workshop</title>
    <link rel="stylesheet" href="../style.css"> <!-- Link to the main CSS file -->
    
    <!-- MathJax for LaTeX rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    

</head>
<body>
    <header class="fade-in">
        <h1>The Israeli Privacy and Fairness Workshop (2025)</h1>
    </header>
    <div class="container fade-in">
    <nav>
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="index.html">Upcoming Workshop</a></li>
            <li><a href="../past.html">Past Workshops</a></li>
        </ul>
    </nav>
    </div>
    <div class="container fade-in">
    <main>
        <h2>Second Israeli Privacy and Fairness Workshop</h2>

        <p><strong>Date:</strong> Thursday, June 12th, 2025</p>
        <p><strong>Location:</strong> Hebrew University of Jerusalem</p>

        <h3>Overview</h3>
        <p>This one day workshop is intended to bring together researchers and students from our community (in the broad sense of the word), and will include a combination of full length and short talks by some of the participants.</p>
        <p>The target audience includes academic and academic-adjacent individuals in Israel working in the fields of Privacy and Fairness.</p>

        <h3>Registration</h3>
        <p><strong>Registration is required!</strong></p>
        <p><a href="https://docs.google.com/forms/d/1HTOkuA5JB6wycBon2YZp5w2nuCLmZm8AmXu3AA4WDtk/viewform" target="_blank" rel="noopener noreferrer" class="btn">Register Now &rarr;</a></p>
        <!-- Note: I've changed the /edit URL to /viewform for the public link -->
        <!-- Add registration link or details here -->

        <h3>Schedule</h3>
        <div id="schedule-container">
            <p>Loading schedule... (JavaScript should replace this)</p>
        </div>

        <h3>Organizers</h3>
        <p>Katrina Ligett and Moshe Shenfeld</p>
        <!-- Add organizer details later -->

        <h3>Contact</h3>
        <p>For inquiries, please contact: moshe.shenfeld [at] mail.huji.ac.il</p>
        <!-- Add contact details later -->

    </main>
    </div>
    <footer class="fade-in">
        <p>&copy; Israeli Privacy and Fairness Workshop</p>
    </footer>

    <script>
        // Function to create schedule HTML with better error handling
        function createScheduleHTML(scheduleData) {
            try {
                let html = '<div class="schedule">';
                
                scheduleData.forEach((item, index) => {
                    // Safely access properties with fallbacks
                    const speaker = (item.speaker || '').toString();
                    const title = (item.title || '').toString();
                    const abstract = (item.abstract || '').toString();
                    const bio = (item.bio || '').toString();
                    const startTime = (item.start_time || '').toString();
                    const endTime = (item.end_time || '').toString();
                    const expandable = (item.expandable || '').toString();
                    
                    console.log(`Item ${index}:`, {
                        speaker: speaker,
                        expandable: expandable,
                        hasAbstract: !!abstract.trim(),
                        hasBio: !!bio.trim(),
                        abstractLength: abstract.length,
                        bioLength: bio.length
                    });
                    
                    const isBreak = speaker.toLowerCase().includes('break') || 
                                  speaker.toLowerCase().includes('lunch') ||
                                  speaker.toLowerCase().includes('registration') ||
                                  !speaker.trim();
                    
                    // Check if item should be expandable
                    const isExpandable = expandable.toLowerCase() === 'true' && !isBreak;
                    const hasContent = !!(abstract.trim() || bio.trim());
                    const isEmpty = isExpandable && !hasContent;
                    
                    console.log(`Item ${index} expandable:`, isExpandable, 'isBreak:', isBreak, 'has content:', hasContent, 'isEmpty:', isEmpty, 'csv expandable:', expandable);
                    
                    let itemClasses = isBreak ? 'break-item' : 'talk-item';
                    if (isEmpty) itemClasses += ' empty-expandable';
                    
                    html += `
                        <div class="schedule-item ${itemClasses}" ${isExpandable ? `onclick="toggleDetails(${index})"` : ''}>
                            <div class="schedule-header">
                                <div class="time">${startTime} - ${endTime}</div>
                                <div class="speaker-title">
                                    <div class="speaker">${speaker}</div>
                                    <div class="title">${title}</div>
                                </div>
                                ${isExpandable ? '<div class="expand-icon">[+]</div>' : ''}
                            </div>
                            ${isExpandable ? `
                            <div class="schedule-details" id="details-${index}" style="display: none;">
                                ${abstract.trim() ? `
                                <div class="abstract">
                                    <h4>Abstract</h4>
                                    <p>${abstract}</p>
                                </div>
                                ` : ''}
                                ${bio.trim() && bio !== 'N/A' ? `
                                <div class="bio">
                                    <h4>Speaker Bio</h4>
                                    <p>${bio}</p>
                                </div>
                                ` : ''}
                                ${!abstract.trim() && (!bio.trim() || bio === 'N/A') ? `
                                <div class="no-content">
                                    <p><em>Abstract and bio coming soon...</em></p>
                                </div>
                                ` : ''}
                            </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                html += '</div>';
                return html;
            } catch (error) {
                console.error('Error creating schedule HTML:', error);
                return '<div class="schedule"><p>Error displaying schedule. Please refresh the page.</p></div>';
            }
        }

        // Function to toggle details visibility with error handling
        function toggleDetails(index) {
            try {
                const details = document.getElementById(`details-${index}`);
                const icon = details.parentElement.querySelector('.expand-icon');
                
                if (!details || !icon) {
                    console.error('Could not find details or icon element for index:', index);
                    return;
                }
                
                if (details.style.display === 'none') {
                    details.style.display = 'block';
                    icon.textContent = '[-]';
                    details.parentElement.classList.add('expanded');
                    
                    // Re-render MathJax for the newly shown content
                    if (window.MathJax) {
                        MathJax.typesetPromise([details]).catch((err) => console.log('MathJax error:', err));
                    }
                } else {
                    details.style.display = 'none';
                    icon.textContent = '[+]';
                    details.parentElement.classList.remove('expanded');
                }
            } catch (error) {
                console.error('Error toggling details for index:', index, error);
            }
        }

        // More robust CSV parser that handles quoted fields with commas
        function parseCSV(text) {
            try {
                const result = [];
                const lines = text.trim().split('\n');
                if (lines.length === 0) return result;
                
                // Parse CSV line considering quotes
                function parseLine(line) {
                    const fields = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        const nextChar = line[i + 1];
                        
                        if (char === '"') {
                            if (inQuotes && nextChar === '"') {
                                // Handle escaped quotes
                                current += '"';
                                i++; // Skip next quote
                            } else {
                                // Toggle quote mode
                                inQuotes = !inQuotes;
                            }
                        } else if (char === ',' && !inQuotes) {
                            fields.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    fields.push(current.trim());
                    return fields;
                }
                
                const headers = parseLine(lines[0]);
                console.log('CSV Headers:', headers);
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    const fields = parseLine(line);
                    const row = {};
                    
                    headers.forEach((header, idx) => {
                        row[header.trim()] = fields[idx] || '';
                    });
                    
                    result.push(row);
                }
                
                console.log('CSV parsed successfully:', result.length, 'rows');
                return result;
            } catch (error) {
                console.error('CSV parsing error:', error);
                return [];
            }
        }

        // Load schedule with retry mechanism
        async function loadScheduleWithRetry(retryCount = 0) {
            const maxRetries = 3;
            try {
                await loadSchedule();
            } catch (error) {
                console.error(`Schedule load attempt ${retryCount + 1} failed:`, error);
                if (retryCount < maxRetries) {
                    console.log(`Retrying in ${(retryCount + 1) * 500}ms...`);
                    setTimeout(() => loadScheduleWithRetry(retryCount + 1), (retryCount + 1) * 500);
                } else {
                    console.error('All retry attempts failed');
                    const container = document.getElementById('schedule-container');
                    if (container) {
                        container.innerHTML = 
                            `<p>Schedule currently unavailable after ${maxRetries} attempts.</p>
                             <p><button onclick="loadScheduleWithRetry(0)">Try Again</button></p>`;
                    }
                }
            }
        }

        // Load and display schedule from external CSV file
        async function loadSchedule() {
            console.log('=== loadSchedule function called ===');
            console.log('Document ready state:', document.readyState);
            console.log('MathJax available:', !!window.MathJax);
            
            const container = document.getElementById('schedule-container');
            if (!container) {
                console.error('Schedule container not found!');
                return;
            }
            
            // Show loading state
            container.innerHTML = '<p>Loading schedule...</p>';
            
            try {
                console.log('Fetching schedule.csv...');
                const response = await fetch('schedule.csv', {
                    cache: 'no-cache', // Prevent caching issues
                    headers: {
                        'Cache-Control': 'no-cache'
                    }
                });
                
                console.log('Fetch response status:', response.status);
                console.log('Fetch response ok:', response.ok);
                
                if (!response.ok) {
                    throw new Error(`Failed to load schedule: ${response.status} ${response.statusText}`);
                }
                
                const csvText = await response.text();
                console.log('CSV text retrieved, length:', csvText.length);
                console.log('First 100 characters:', csvText.substring(0, 100));
                
                if (!csvText.trim()) {
                    throw new Error('CSV file is empty');
                }
                
                const scheduleData = parseCSV(csvText);
                console.log('Schedule data parsed, items:', scheduleData.length);
                
                if (scheduleData.length === 0) {
                    throw new Error('No schedule data parsed from CSV');
                }
                
                console.log('Creating HTML...');
                const html = createScheduleHTML(scheduleData);
                console.log('HTML created, length:', html.length);
                
                container.innerHTML = html;
                console.log('HTML inserted into container');
                
                // Render LaTeX math after content is loaded
                if (window.MathJax) {
                    console.log('Rendering MathJax...');
                    MathJax.typesetPromise([container]).catch((err) => console.log('MathJax error:', err));
                } else {
                    console.log('MathJax not available yet');
                }
                
            } catch (error) {
                console.error('Error loading schedule:', error);
                console.error('Error stack:', error.stack);
                container.innerHTML = 
                    `<p>Schedule currently unavailable. Error: ${error.message}</p>
                     <p><small>Check browser console for details.</small></p>`;
            }
        }

        // Load schedule when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMContentLoaded event fired');
            loadScheduleWithRetry(0);
        });
    </script>
</body>
</html> 